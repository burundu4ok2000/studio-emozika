(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&u(h)}).observe(document,{childList:!0,subtree:!0});function d(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(s){if(s.ep)return;s.ep=!0;const i=d(s);fetch(s.href,i)}})();function Z(){const n=document.querySelectorAll(".reveal-on-scroll");if(n.length){const l=new IntersectionObserver(d=>{d.forEach(u=>{u.isIntersecting&&(u.target.classList.add("is-visible"),l.unobserve(u.target))})},{threshold:.15});n.forEach(d=>l.observe(d))}}function ee(){const n=document.querySelectorAll("[data-scroll-to]");n.length&&n.forEach(l=>{const d=l.getAttribute("data-scroll-to");d&&l.addEventListener("click",u=>{const s=document.getElementById(d);s&&(u.preventDefault(),s.scrollIntoView({behavior:"smooth",block:"start"}))})})}let P=0,S=!1,q=null;function J(n){q&&q.contains(n.target)||n.preventDefault()}function _(n=null){S||(P=window.scrollY,q=n,S=!0,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${P}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.width="100%",document.addEventListener("touchmove",J,{passive:!1}))}function j(){S&&(document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.width="",document.removeEventListener("touchmove",J),window.scrollTo(0,P),S=!1,q=null)}function te(){const n=document.querySelector("#afisha");if(n){let R=function(){return E.filter(function(o){return o.showInAfisha}).sort(function(o,e){const c=typeof o.afishaOrder=="number"?o.afishaOrder:999,f=typeof e.afishaOrder=="number"?e.afishaOrder:999;return c-f})},Y=function(o){const e=[];return o.age&&e.push(o.age),o.genre&&e.push(o.genre),o.duration&&e.push(o.duration),o.hall&&e.push(o.hall),o.city&&e.push(o.city),e.join(" • ")},F=function(o){const e=[];return o.genre&&e.push(o.genre),o.age&&e.push(o.age),e.join(" • ")},G=function(){if(!m)return;const o=R();if(!o.length){m.innerHTML='<p class="afisha-empty">Скоро здесь появятся спектакли театра «Эмоцика».</p>';return}const e=o.map(function(c){const f=c.poster&&c.poster.desktop?c.poster.desktop:"",r=F(c);let a="";if(c.badge){let w="afisha-card-badge badge badge--glass";c.badgeType&&(w+=" afisha-card-badge--"+c.badgeType),a='<span class="'+w+'">'+c.badge+"</span>"}return'<article class="afisha-card afisha-card--strip" data-play-id="'+c.id+'"><div class="afisha-card-poster-wrapper">'+(f?'<img class="afisha-card-poster-image" src="'+f+'" alt="Постер спектакля '+c.title+'">'+(a?'<div class="afisha-card-badge-wrap">'+a+"</div>":""):"")+'</div><div class="afisha-card-footer">'+(r?'<p class="afisha-card-subline">'+r+"</p>":"")+'<h3 class="afisha-title">'+c.title+'</h3><div class="afisha-buttons afisha-buttons--strip">'+(c.ticketUrl?'<a class="btn btn-primary btn-lg" href="'+c.ticketUrl+'" target="_blank" rel="noopener">Купить билет</a>':"")+'<button type="button" class="btn btn-outline btn-lg" data-play-open="'+c.id+'">Подробнее о спектакле</button></div></div></article>'}).join("");m.innerHTML=e},K=function(o){if(!t||!E.length)return;const e=E.find(function(r){return r.id===o});if(!e)return;const c=Y(e);if(g&&(e.badge?(g.textContent=e.badge,g.classList.remove("is-hidden")):(g.textContent="",g.classList.add("is-hidden"))),V&&(V.textContent=e.title||""),k&&(k.textContent=c||"",k.classList.toggle("is-hidden",!c)),A&&(A.textContent=e.tagline||"",A.classList.toggle("is-hidden",!e.tagline)),x&&(x.innerHTML="",Array.isArray(e.description)&&e.description.length&&e.description.forEach(function(r){const a=document.createElement("p");a.textContent=r,x.appendChild(a)})),C&&T&&(C.innerHTML="",Array.isArray(e.whyToWatch)&&e.whyToWatch.length?(e.whyToWatch.forEach(function(r){const a=document.createElement("li");a.textContent=r,C.appendChild(a)}),T.classList.remove("is-hidden")):T.classList.add("is-hidden")),B){const r=e.credits&&e.credits.author;B.textContent=r?"Автор: "+e.credits.author:"",B.classList.toggle("is-hidden",!r)}if(O){const r=e.credits&&e.credits.director;O.textContent=r?"Режиссёр: "+e.credits.director:"",O.classList.toggle("is-hidden",!r)}if(I&&W&&M){I.innerHTML="";const r=e.credits&&Array.isArray(e.credits.cast)?e.credits.cast:[];if(r.length){const a=e.credits.castTitle||"В ролях";W.textContent=a,r.forEach(function(w){const $=document.createElement("li");$.textContent=w,I.appendChild($)}),M.classList.remove("is-hidden")}else M.classList.add("is-hidden")}if(p&&(p.innerHTML="",p.style.display="",e.media&&e.media.videoEmbed?(p.style.display="block",p.innerHTML=e.media.videoEmbed):e.media&&Array.isArray(e.media.photos)&&e.media.photos.length&&(p.style.display="grid",e.media.photos.forEach(function(r){const a=document.createElement("img");a.src=r,a.alt="Фотография спектакля "+e.title,a.className="play-modal-photo",p.appendChild(a)}))),H&&(H.innerHTML="",e.media&&e.media.video)){const r=document.createElement("div");r.className="play-modal-video-placeholder",r.textContent="Видео спектакля скоро появится на сайте.",H.appendChild(r)}v&&(e.ticketUrl?(v.href=e.ticketUrl,v.classList.remove("is-hidden")):(v.removeAttribute("href"),v.classList.add("is-hidden"))),t.removeAttribute("hidden"),document.body.classList.add("has-modal-open");const f=t.querySelector(".play-modal__dialog");_(f)},L=function(){t&&(t.setAttribute("hidden","true"),document.body.classList.remove("has-modal-open"),j())},Q=function(){if(!m)return;m.addEventListener("click",function(e){const c=e.target.closest("[data-play-open]");if(!c)return;const f=c.getAttribute("data-play-open");f&&K(f)});function o(e){if(!m)return;const c=m.querySelector(".afisha-card--strip"),f=c?c.getBoundingClientRect().width:320,r=20,a=e==="next"?f+r:-(f+r);m.scrollBy({left:a,behavior:"smooth"})}N&&N.addEventListener("click",function(){o("prev")}),U&&U.addEventListener("click",function(){o("next")}),t&&(X.forEach(function(e){e.addEventListener("click",L)}),t.addEventListener("click",function(e){e.target===t&&L()}),document.addEventListener("keydown",function(e){e.key==="Escape"&&t&&!t.hasAttribute("hidden")&&L()}))};var l=R,d=Y,u=F,s=G,i=K,h=L,b=Q;const m=n.querySelector("[data-afisha-strip]"),N=n.querySelector(".afisha-strip-arrow--prev"),U=n.querySelector(".afisha-strip-arrow--next"),t=document.querySelector("[data-play-modal]"),X=t?t.querySelectorAll("[data-play-modal-close]"):[],g=t?t.querySelector("[data-play-badge]"):null,V=t?t.querySelector("[data-play-title]"):null,k=t?t.querySelector("[data-play-meta]"):null,A=t?t.querySelector("[data-play-tagline]"):null,x=t?t.querySelector("[data-play-description]"):null,C=t?t.querySelector("[data-play-why]"):null,T=t?t.querySelector("[data-play-why-container]"):null,B=t?t.querySelector("[data-play-author]"):null,O=t?t.querySelector("[data-play-director]"):null,W=t?t.querySelector("[data-play-cast-title]"):null,I=t?t.querySelector("[data-play-cast]"):null,M=t?t.querySelector("[data-play-cast-container]"):null,p=t?t.querySelector("[data-play-photos]"):null,H=t?t.querySelector("[data-play-video]"):null,v=t?t.querySelector("[data-play-ticket]"):null;let E=[];fetch("assets/data/plays.json").then(function(o){if(!o.ok)throw new Error("HTTP "+o.status);return o.json()}).then(function(o){!o||!Array.isArray(o.plays)||(E=o.plays.slice(),G(),Q())}).catch(function(o){console.error("Не удалось загрузить данные спектаклей:",o)})}}function oe(){const n=document.querySelector(".section-snow-queen"),l=n?n.querySelector(".snow-queen-grid"):null;!n||!l||("IntersectionObserver"in window?new IntersectionObserver((u,s)=>{u.forEach(i=>{i.isIntersecting&&(setTimeout(()=>{l.classList.add("snow-queen-grid--visible")},3e3),s.unobserve(i.target))})},{threshold:.4}).observe(n):l.classList.add("snow-queen-grid--visible"))}function ne(){const n=document.querySelector("[data-docs-modal]");if(!n)return;const l=document.querySelectorAll("[data-open-docs-modal]"),d=n.querySelectorAll("[data-close-docs-modal]");function u(){n.removeAttribute("hidden");const i=n.querySelector(".docs-modal__dialog");_(i),i&&i.focus()}function s(){n.setAttribute("hidden",""),j()}l.forEach(i=>{i.addEventListener("click",h=>{h.preventDefault(),u()})}),d.forEach(i=>{i.addEventListener("click",s)}),document.addEventListener("keydown",i=>{i.key==="Escape"&&!n.hasAttribute("hidden")&&s()})}function ie(){const n=document.getElementById("location-video-lightbox"),l=document.getElementById("location-video-iframe"),d=document.querySelector("[data-open-location-video]"),u=document.querySelectorAll("[data-close-location-video]"),s="https://vk.com/video_ext.php?oid=-232221941&id=456239082";if(!n||!l||!d){console.warn("Video lightbox elements not found");return}function i(){n.removeAttribute("hidden"),l.src=s,_(n),n.focus()}function h(){n.setAttribute("hidden",""),l.src="",j()}d.addEventListener("click",i),u.forEach(b=>{b.addEventListener("click",h)}),document.addEventListener("keydown",b=>{b.key==="Escape"&&!n.hasAttribute("hidden")&&h()})}const y=document.querySelector(".site-header"),z=document.querySelector("[data-header-toggle]"),D=document.body;z&&y&&(z.addEventListener("click",()=>{y.classList.toggle("is-open"),y.classList.contains("is-open")?D.style.overflow="hidden":D.style.overflow=""}),y.querySelectorAll(".nav-link").forEach(l=>{l.addEventListener("click",()=>{y.classList.remove("is-open"),D.style.overflow=""})}));y&&window.addEventListener("scroll",()=>{window.scrollY>20?y.classList.add("scrolled"):y.classList.remove("scrolled")});document.addEventListener("DOMContentLoaded",()=>{Z(),ee(),oe(),ie(),ne(),te()});
