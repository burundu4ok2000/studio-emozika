import"./style-D0YbfStJ.js";function Q(){const o=document.querySelectorAll(".reveal-on-scroll");if(o.length){const i=new IntersectionObserver(l=>{l.forEach(d=>{d.isIntersecting&&(d.target.classList.add("is-visible"),i.unobserve(d.target))})},{threshold:.15});o.forEach(l=>i.observe(l))}}function $(){const o=document.querySelectorAll("[data-scroll-to]");o.length&&o.forEach(i=>{const l=i.getAttribute("data-scroll-to");l&&i.addEventListener("click",d=>{const t=document.getElementById(l);t&&(d.preventDefault(),t.scrollIntoView({behavior:"smooth",block:"start"}))})})}let H=0,b=!1,E=null;function U(o){E&&E.contains(o.target)||o.preventDefault()}function D(o=null){b||(H=window.scrollY,E=o,b=!0,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${H}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.width="100%",document.addEventListener("touchmove",U,{passive:!1}))}function O(){b&&(document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.width="",document.removeEventListener("touchmove",U),window.scrollTo(0,H),b=!1,E=null)}function z(){const o=document.querySelector("#afisha");if(o){let V=function(){return g.filter(function(n){return n.showInAfisha}).sort(function(n,e){const r=typeof n.afishaOrder=="number"?n.afishaOrder:999,u=typeof e.afishaOrder=="number"?e.afishaOrder:999;return r-u})},W=function(n){const e=[];return n.age&&e.push(n.age),n.genre&&e.push(n.genre),n.duration&&e.push(n.duration),n.hall&&e.push(n.hall),n.city&&e.push(n.city),e.join(" • ")},R=function(n){const e=[];return n.genre&&e.push(n.genre),n.age&&e.push(n.age),e.join(" • ")},Y=function(){if(!i)return;const n=V();if(!n.length){i.innerHTML='<p class="afisha-empty">Скоро здесь появятся спектакли театра «Эмоцика».</p>';return}const e=n.map(function(r){const u=r.poster&&r.poster.desktop?r.poster.desktop:"",s=R(r);let a="";if(r.badge){let v="afisha-card-badge badge badge--glass";r.badgeType&&(v+=" afisha-card-badge--"+r.badgeType),a='<span class="'+v+'">'+r.badge+"</span>"}return'<article class="afisha-card afisha-card--strip" data-play-id="'+r.id+'"><div class="afisha-card-poster-wrapper">'+(u?'<img class="afisha-card-poster-image" src="'+u+'" alt="Постер спектакля '+r.title+'">'+(a?'<div class="afisha-card-badge-wrap">'+a+"</div>":""):"")+'</div><div class="afisha-card-footer">'+(s?'<p class="afisha-card-subline">'+s+"</p>":"")+'<h3 class="afisha-title">'+r.title+'</h3><div class="afisha-buttons afisha-buttons--strip">'+(r.ticketUrl?'<a class="btn btn-primary btn-lg" href="'+r.ticketUrl+'" target="_blank" rel="noopener">Купить билет</a>':"")+'<a class="btn btn-outline btn-lg" href="plays/'+r.id+'.html">Подробнее о спектакле</a></div></div></article>'}).join("");i.innerHTML=e},N=function(n){if(!t||!g.length)return;const e=g.find(function(s){return s.id===n});if(!e)return;const r=W(e);if(f&&(e.badge?(f.textContent=e.badge,f.classList.remove("is-hidden")):(f.textContent="",f.classList.add("is-hidden"))),y&&(y.textContent=e.title||""),L&&(L.textContent=r||"",L.classList.toggle("is-hidden",!r)),w&&(w.textContent=e.tagline||"",w.classList.toggle("is-hidden",!e.tagline)),S&&(S.innerHTML="",Array.isArray(e.description)&&e.description.length&&e.description.forEach(function(s){const a=document.createElement("p");a.textContent=s,S.appendChild(a)})),k&&q&&(k.innerHTML="",Array.isArray(e.whyToWatch)&&e.whyToWatch.length?(e.whyToWatch.forEach(function(s){const a=document.createElement("li");a.textContent=s,k.appendChild(a)}),q.classList.remove("is-hidden")):q.classList.add("is-hidden")),A){const s=e.credits&&e.credits.author;A.textContent=s?"Автор: "+e.credits.author:"",A.classList.toggle("is-hidden",!s)}if(x){const s=e.credits&&e.credits.director;x.textContent=s?"Режиссёр: "+e.credits.director:"",x.classList.toggle("is-hidden",!s)}if(C&&P&&T){C.innerHTML="";const s=e.credits&&Array.isArray(e.credits.cast)?e.credits.cast:[];if(s.length){const a=e.credits.castTitle||"В ролях";P.textContent=a,s.forEach(function(v){const _=document.createElement("li");_.textContent=v,C.appendChild(_)}),T.classList.remove("is-hidden")}else T.classList.add("is-hidden")}if(m&&(m.innerHTML="",m.style.display="",e.media&&e.media.videoEmbed?(m.style.display="block",m.innerHTML=e.media.videoEmbed):e.media&&Array.isArray(e.media.photos)&&e.media.photos.length&&(m.style.display="grid",e.media.photos.forEach(function(s){const a=document.createElement("img");a.src=s,a.alt="Фотография спектакля "+e.title,a.className="play-modal-photo",m.appendChild(a)}))),M&&(M.innerHTML="",e.media&&e.media.video)){const s=document.createElement("div");s.className="play-modal-video-placeholder",s.textContent="Видео спектакля скоро появится на сайте.",M.appendChild(s)}p&&(e.ticketUrl?(p.href=e.ticketUrl,p.classList.remove("is-hidden")):(p.removeAttribute("href"),p.classList.add("is-hidden"))),t.removeAttribute("hidden"),document.body.classList.add("has-modal-open");const u=t.querySelector(".play-modal__dialog");D(u)},B=function(){t&&(t.setAttribute("hidden","true"),document.body.classList.remove("has-modal-open"),O())},G=function(){if(!i)return;i.addEventListener("click",function(e){const r=e.target.closest("[data-play-open]");if(!r)return;const u=r.getAttribute("data-play-open");u&&N(u)});function n(e){if(!i)return;const r=i.querySelector(".afisha-card--strip"),u=r?r.getBoundingClientRect().width:320,s=20,a=e==="next"?u+s:-(u+s);i.scrollBy({left:a,behavior:"smooth"})}l&&l.addEventListener("click",function(){n("prev")}),d&&d.addEventListener("click",function(){n("next")}),t&&(c.forEach(function(e){e.addEventListener("click",B)}),t.addEventListener("click",function(e){e.target===t&&B()}),document.addEventListener("keydown",function(e){e.key==="Escape"&&t&&!t.hasAttribute("hidden")&&B()}))};const i=o.querySelector("[data-afisha-strip]"),l=o.querySelector(".afisha-strip-arrow--prev"),d=o.querySelector(".afisha-strip-arrow--next"),t=document.querySelector("[data-play-modal]"),c=t?t.querySelectorAll("[data-play-modal-close]"):[],f=t?t.querySelector("[data-play-badge]"):null,y=t?t.querySelector("[data-play-title]"):null,L=t?t.querySelector("[data-play-meta]"):null,w=t?t.querySelector("[data-play-tagline]"):null,S=t?t.querySelector("[data-play-description]"):null,k=t?t.querySelector("[data-play-why]"):null,q=t?t.querySelector("[data-play-why-container]"):null,A=t?t.querySelector("[data-play-author]"):null,x=t?t.querySelector("[data-play-director]"):null,P=t?t.querySelector("[data-play-cast-title]"):null,C=t?t.querySelector("[data-play-cast]"):null,T=t?t.querySelector("[data-play-cast-container]"):null,m=t?t.querySelector("[data-play-photos]"):null,M=t?t.querySelector("[data-play-video]"):null,p=t?t.querySelector("[data-play-ticket]"):null;let g=[];fetch("assets/data/plays.json").then(function(n){if(!n.ok)throw new Error("HTTP "+n.status);return n.json()}).then(function(n){!n||!Array.isArray(n.plays)||(g=n.plays.slice(),Y(),G())}).catch(function(n){console.error("Не удалось загрузить данные спектаклей:",n)})}}function F(){const o=document.querySelector(".section-snow-queen"),i=o?o.querySelector(".snow-queen-grid"):null;!o||!i||("IntersectionObserver"in window?new IntersectionObserver((d,t)=>{d.forEach(c=>{c.isIntersecting&&(setTimeout(()=>{i.classList.add("snow-queen-grid--visible")},3e3),t.unobserve(c.target))})},{threshold:.4}).observe(o):i.classList.add("snow-queen-grid--visible"))}function J(){const o=document.querySelector("[data-docs-modal]");if(!o)return;const i=document.querySelectorAll("[data-open-docs-modal]"),l=o.querySelectorAll("[data-close-docs-modal]");function d(){o.removeAttribute("hidden");const c=o.querySelector(".docs-modal__dialog");D(c),c&&c.focus()}function t(){o.setAttribute("hidden",""),O()}i.forEach(c=>{c.addEventListener("click",f=>{f.preventDefault(),d()})}),l.forEach(c=>{c.addEventListener("click",t)}),document.addEventListener("keydown",c=>{c.key==="Escape"&&!o.hasAttribute("hidden")&&t()})}function K(){const o=document.getElementById("location-video-lightbox"),i=document.getElementById("location-video-iframe"),l=document.querySelector("[data-open-location-video]"),d=document.querySelectorAll("[data-close-location-video]"),t="https://vk.com/video_ext.php?oid=-232221941&id=456239082";if(!o||!i||!l){console.warn("Video lightbox elements not found");return}function c(){o.removeAttribute("hidden"),i.src=t,D(o),o.focus()}function f(){o.setAttribute("hidden",""),i.src="",O()}l.addEventListener("click",c),d.forEach(y=>{y.addEventListener("click",f)}),document.addEventListener("keydown",y=>{y.key==="Escape"&&!o.hasAttribute("hidden")&&f()})}const h=document.querySelector(".site-header"),j=document.querySelector("[data-header-toggle]"),I=document.body;j&&h&&(j.addEventListener("click",()=>{h.classList.toggle("is-open"),h.classList.contains("is-open")?I.style.overflow="hidden":I.style.overflow=""}),h.querySelectorAll(".nav-link").forEach(i=>{i.addEventListener("click",()=>{h.classList.remove("is-open"),I.style.overflow=""})}));h&&window.addEventListener("scroll",()=>{window.scrollY>20?h.classList.add("scrolled"):h.classList.remove("scrolled")});document.addEventListener("DOMContentLoaded",()=>{Q(),$(),F(),K(),J(),z()});
