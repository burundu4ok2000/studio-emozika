(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&u(f)}).observe(document,{childList:!0,subtree:!0});function d(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function u(s){if(s.ep)return;s.ep=!0;const r=d(s);fetch(s.href,r)}})();function $(){const i=document.querySelectorAll(".reveal-on-scroll");if(i.length){const a=new IntersectionObserver(d=>{d.forEach(u=>{u.isIntersecting&&(u.target.classList.add("is-visible"),a.unobserve(u.target))})},{threshold:.15});i.forEach(d=>a.observe(d))}}function z(){const i=document.querySelectorAll("[data-scroll-to]");i.length&&i.forEach(a=>{const d=a.getAttribute("data-scroll-to");d&&a.addEventListener("click",u=>{const s=document.getElementById(d);s&&(u.preventDefault(),s.scrollIntoView({behavior:"smooth",block:"start"}))})})}let H=0;function D(){H=window.scrollY,document.body.style.position="fixed",document.body.style.top=`-${H}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.overflow="hidden"}function P(){document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.overflow="",window.scrollTo(0,H)}function J(){const i=document.querySelector("#afisha");if(i){let _=function(){return L.filter(function(o){return o.showInAfisha}).sort(function(o,e){const c=typeof o.afishaOrder=="number"?o.afishaOrder:999,n=typeof e.afishaOrder=="number"?e.afishaOrder:999;return c-n})},W=function(o){const e=[];return o.age&&e.push(o.age),o.genre&&e.push(o.genre),o.duration&&e.push(o.duration),o.hall&&e.push(o.hall),o.city&&e.push(o.city),e.join(" • ")},R=function(o){const e=[];return o.genre&&e.push(o.genre),o.age&&e.push(o.age),e.join(" • ")},Y=function(){if(!h)return;const o=_();if(!o.length){h.innerHTML='<p class="afisha-empty">Скоро здесь появятся спектакли театра «Эмоцика».</p>';return}const e=o.map(function(c){const n=c.poster&&c.poster.desktop?c.poster.desktop:"",l=R(c);let y="";if(c.badge){let v="afisha-card-badge badge badge--glass";c.badgeType&&(v+=" afisha-card-badge--"+c.badgeType),y='<span class="'+v+'">'+c.badge+"</span>"}return'<article class="afisha-card afisha-card--strip" data-play-id="'+c.id+'"><div class="afisha-card-poster-wrapper">'+(n?'<img class="afisha-card-poster-image" src="'+n+'" alt="Постер спектакля '+c.title+'">'+(y?'<div class="afisha-card-badge-wrap">'+y+"</div>":""):"")+'</div><div class="afisha-card-footer">'+(l?'<p class="afisha-card-subline">'+l+"</p>":"")+'<h3 class="afisha-title">'+c.title+'</h3><div class="afisha-buttons afisha-buttons--strip">'+(c.ticketUrl?'<a class="btn btn-primary btn-lg" href="'+c.ticketUrl+'" target="_blank" rel="noopener">Купить билет</a>':"")+'<button type="button" class="btn btn-outline btn-lg" data-play-open="'+c.id+'">Подробнее о спектакле</button></div></div></article>'}).join("");h.innerHTML=e},F=function(o){if(!t||!L.length)return;const e=L.find(function(n){return n.id===o});if(!e)return;const c=W(e);if(g&&(e.badge?(g.textContent=e.badge,g.classList.remove("is-hidden")):(g.textContent="",g.classList.add("is-hidden"))),U&&(U.textContent=e.title||""),S&&(S.textContent=c||"",S.classList.toggle("is-hidden",!c)),q&&(q.textContent=e.tagline||"",q.classList.toggle("is-hidden",!e.tagline)),k&&(k.innerHTML="",Array.isArray(e.description)&&e.description.length&&e.description.forEach(function(n){const l=document.createElement("p");l.textContent=n,k.appendChild(l)})),A&&x&&(A.innerHTML="",Array.isArray(e.whyToWatch)&&e.whyToWatch.length?(e.whyToWatch.forEach(function(n){const l=document.createElement("li");l.textContent=n,A.appendChild(l)}),x.classList.remove("is-hidden")):x.classList.add("is-hidden")),C){const n=e.credits&&e.credits.author;C.textContent=n?"Автор: "+e.credits.author:"",C.classList.toggle("is-hidden",!n)}if(T){const n=e.credits&&e.credits.director;T.textContent=n?"Режиссёр: "+e.credits.director:"",T.classList.toggle("is-hidden",!n)}if(B&&V&&O){B.innerHTML="";const n=e.credits&&Array.isArray(e.credits.cast)?e.credits.cast:[];if(n.length){const l=e.credits.castTitle||"В ролях";V.textContent=l,n.forEach(function(y){const v=document.createElement("li");v.textContent=y,B.appendChild(v)}),O.classList.remove("is-hidden")}else O.classList.add("is-hidden")}if(p&&(p.innerHTML="",p.style.display="",e.media&&e.media.videoEmbed?(p.style.display="block",p.innerHTML=e.media.videoEmbed):e.media&&Array.isArray(e.media.photos)&&e.media.photos.length&&(p.style.display="grid",e.media.photos.forEach(function(n){const l=document.createElement("img");l.src=n,l.alt="Фотография спектакля "+e.title,l.className="play-modal-photo",p.appendChild(l)}))),I&&(I.innerHTML="",e.media&&e.media.video)){const n=document.createElement("div");n.className="play-modal-video-placeholder",n.textContent="Видео спектакля скоро появится на сайте.",I.appendChild(n)}b&&(e.ticketUrl?(b.href=e.ticketUrl,b.classList.remove("is-hidden")):(b.removeAttribute("href"),b.classList.add("is-hidden"))),t.removeAttribute("hidden"),document.body.classList.add("has-modal-open"),D()},w=function(){t&&(t.setAttribute("hidden","true"),document.body.classList.remove("has-modal-open"),P())},G=function(){if(!h)return;h.addEventListener("click",function(e){const c=e.target.closest("[data-play-open]");if(!c)return;const n=c.getAttribute("data-play-open");n&&F(n)});function o(e){if(!h)return;const c=h.querySelector(".afisha-card--strip"),n=c?c.getBoundingClientRect().width:320,l=20,y=e==="next"?n+l:-(n+l);h.scrollBy({left:y,behavior:"smooth"})}j&&j.addEventListener("click",function(){o("prev")}),N&&N.addEventListener("click",function(){o("next")}),t&&(Q.forEach(function(e){e.addEventListener("click",w)}),t.addEventListener("click",function(e){e.target===t&&w()}),document.addEventListener("keydown",function(e){e.key==="Escape"&&t&&!t.hasAttribute("hidden")&&w()}))};var a=_,d=W,u=R,s=Y,r=F,f=w,E=G;const h=i.querySelector("[data-afisha-strip]"),j=i.querySelector(".afisha-strip-arrow--prev"),N=i.querySelector(".afisha-strip-arrow--next"),t=document.querySelector("[data-play-modal]"),Q=t?t.querySelectorAll("[data-play-modal-close]"):[],g=t?t.querySelector("[data-play-badge]"):null,U=t?t.querySelector("[data-play-title]"):null,S=t?t.querySelector("[data-play-meta]"):null,q=t?t.querySelector("[data-play-tagline]"):null,k=t?t.querySelector("[data-play-description]"):null,A=t?t.querySelector("[data-play-why]"):null,x=t?t.querySelector("[data-play-why-container]"):null,C=t?t.querySelector("[data-play-author]"):null,T=t?t.querySelector("[data-play-director]"):null,V=t?t.querySelector("[data-play-cast-title]"):null,B=t?t.querySelector("[data-play-cast]"):null,O=t?t.querySelector("[data-play-cast-container]"):null,p=t?t.querySelector("[data-play-photos]"):null,I=t?t.querySelector("[data-play-video]"):null,b=t?t.querySelector("[data-play-ticket]"):null;let L=[];fetch("assets/data/plays.json").then(function(o){if(!o.ok)throw new Error("HTTP "+o.status);return o.json()}).then(function(o){!o||!Array.isArray(o.plays)||(L=o.plays.slice(),Y(),G())}).catch(function(o){console.error("Не удалось загрузить данные спектаклей:",o)})}}function X(){const i=document.querySelector(".section-snow-queen"),a=i?i.querySelector(".snow-queen-grid"):null;!i||!a||("IntersectionObserver"in window?new IntersectionObserver((u,s)=>{u.forEach(r=>{r.isIntersecting&&(setTimeout(()=>{a.classList.add("snow-queen-grid--visible")},3e3),s.unobserve(r.target))})},{threshold:.4}).observe(i):a.classList.add("snow-queen-grid--visible"))}function Z(){const i=document.querySelector("[data-docs-modal]");if(!i)return;const a=document.querySelectorAll("[data-open-docs-modal]"),d=i.querySelectorAll("[data-close-docs-modal]");function u(){i.removeAttribute("hidden"),D();const r=i.querySelector(".docs-modal__dialog");r&&r.focus()}function s(){i.setAttribute("hidden",""),P()}a.forEach(r=>{r.addEventListener("click",f=>{f.preventDefault(),u()})}),d.forEach(r=>{r.addEventListener("click",s)}),document.addEventListener("keydown",r=>{r.key==="Escape"&&!i.hasAttribute("hidden")&&s()})}function ee(){const i=document.getElementById("location-video-lightbox"),a=document.getElementById("location-video-iframe"),d=document.querySelector("[data-open-location-video]"),u=document.querySelectorAll("[data-close-location-video]"),s="https://vk.com/video_ext.php?oid=-232221941&id=456239082";if(!i||!a||!d){console.warn("Video lightbox elements not found");return}function r(){i.removeAttribute("hidden"),a.src=s,D(),i.focus()}function f(){i.setAttribute("hidden",""),a.src="",P()}d.addEventListener("click",r),u.forEach(E=>{E.addEventListener("click",f)}),document.addEventListener("keydown",E=>{E.key==="Escape"&&!i.hasAttribute("hidden")&&f()})}const m=document.querySelector(".site-header"),K=document.querySelector("[data-header-toggle]"),M=document.body;K&&m&&(K.addEventListener("click",()=>{m.classList.toggle("is-open"),m.classList.contains("is-open")?M.style.overflow="hidden":M.style.overflow=""}),m.querySelectorAll(".nav-link").forEach(a=>{a.addEventListener("click",()=>{m.classList.remove("is-open"),M.style.overflow=""})}));m&&window.addEventListener("scroll",()=>{window.scrollY>20?m.classList.add("scrolled"):m.classList.remove("scrolled")});document.addEventListener("DOMContentLoaded",()=>{$(),z(),X(),ee(),Z(),J()});
